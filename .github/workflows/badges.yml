name: Generate Status Badges (DISABLED)

# DISABLED: Only gauth.yml workflow is enabled
# This workflow is disabled to prevent conflicts with the main gauth workflow

on:
  # Disabled - will never trigger
  workflow_dispatch:
    inputs:
      force_run:
        description: 'Force run this workflow (DISABLED)'
        required: true
        default: false
        type: boolean

jobs:
  update-badges:
    name: Update Status Badges
    runs-on: ubuntu-latest
    if: github.event.workflow_run.conclusion != 'skipped'
    permissions:
      contents: write
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
      
    - name: Generate Badge URLs
      run: |
        # Create a temporary file with the badges section
        cat > badges_section.md << 'EOF'
        
        ## CI/CD Status
        
        ### Component Workflows
        - **Renclave-v2**: ![Renclave-v2 CI/CD](https://github.com/${{ github.repository }}/workflows/Renclave-v2%20CI%20CD/badge.svg)
        - **Gauth**: ![Gauth CI/CD](https://github.com/${{ github.repository }}/workflows/Gauth%20CI%20CD/badge.svg)
        - **Web**: ![Web CI/CD](https://github.com/${{ github.repository }}/workflows/Web%20CI%20CD/badge.svg)
        
        ### Integration Workflow
        - **Full Project**: ![Full Project CI/CD](https://github.com/${{ github.repository }}/workflows/Full%20Project%20CI%20CD/badge.svg)
        
        *Last updated: ${{ github.event.workflow_run.updated_at }}*
        
        EOF
        
        # Check if badges section already exists in README
        if grep -q "## CI/CD Status" README.md; then
          # Replace existing badges section
          awk '
            /^## CI/CD Status/ { 
              skip = 1; 
              while ((getline line < "badges_section.md") > 0) print line; 
              close("badges_section.md");
              next 
            }
            skip && /^##/ && !/^## CI\/CD Status/ { skip = 0 }
            !skip { print }
          ' README.md > README_new.md
          mv README_new.md README.md
        else
          # Add badges section after the first heading
          awk '
            NR == 1 { print; print ""; while ((getline line < "badges_section.md") > 0) print line; close("badges_section.md"); next }
            { print }
          ' README.md > README_new.md
          mv README_new.md README.md
        fi
        
        # Clean up temporary file
        rm badges_section.md
        
    - name: Commit Badge Updates
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add README.md
        git diff --quiet && git diff --staged --quiet || git commit -m "Update CI/CD status badges in README"
        git push
